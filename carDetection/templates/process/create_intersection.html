{% extends "layout.html" %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'style/layout.css' %}">
<!-- Ensure the map container has a specific height -->
<style>
    #map {
        height: 400px; /* or any other height */
    }
</style>
{% endblock %}

{% block content %}
<h1>Create Intersection</h1>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div id="map"></div>
    {{ form.as_p }}
    <input type="submit" value="Submit">
</form>

<!-- Loading Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">

<!-- Leaflet's JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
    // Initialize the map
    var map = L.map('map').setView([13.7563, 100.5018], 13); // Centered on Bangkok, Thailand

    // Add a tile layer to the map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    var popup = L.popup();

function onMapClick(e) {
    popup
        .setLatLng(e.latlng)
        .setContent("You clicked the map at " + e.latlng.toString())
        .openOn(map);
}

map.on('click', onMapClick);
</script>

<div class="intersection_list">
    <table>
        <thead>
            <tr>
                <th>Intersection name</th>
                <th>Location</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for intersection in intersections %}
            <tr>
                <td>{{ intersection.intersection_name }}</td>
                <td>{{ intersection.location }}</td>
                <td><a href="{% url 'create_intersection' %}">View Details</a></td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3">No intersections found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock content %}
