<!DOCTYPE html>
<html>
<head>
    <title>Task Status Example</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<button id="startTaskBtn">Start Task</button>
<div id="taskResult">Task result will appear here...</div>

<h1>Task Queue Status</h1>
    <table border="1">
        <thead>
            <tr>
                <th>Task ID</th>
                <th>Name</th> <!-- Displaying task name/description -->
                <th>Status</th>
                <th>Result</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td>{{ task.name }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.result }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script>
$(document).ready(function(){
    $('#startTaskBtn').click(function(){
        $.ajax({
            url: '{% url "start-task" %}',
            success: function(data) {
                let taskId = data.task_id;
                let interval = setInterval(function(){
                    $.ajax({
                        url: 'task-status/' + taskId + '/',
                        success: function(data) {
                            if (data.status == 'SUCCESS') {
                                $('#taskResult').text('Task result: ' + data.result);
                                clearInterval(interval);
                            }
                        }
                    });
                }, 1000); // Poll every 1000 milliseconds (1 second)
            }
        });
    });
});
</script>

</body>
</html>
